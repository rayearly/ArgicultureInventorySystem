@using Microsoft.Ajax.Utilities
@model ArgicultureInventorySystem.ViewModel.UcBookingStockViewModel

@{
    ViewBag.Title = "Create";
}
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<h2>Create New Booking</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <h4>Enter Booking Information</h4>
    <hr />
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    <div>


        <dl class="dl-horizontal">
            <dt>@Html.LabelFor(model => model.ApplicationUser.Name, "User Name", htmlAttributes: new { @class = "control-label col-md-2" })</dt>
            <dd>@Html.DisplayFor(model => model.ApplicationUser.Name, new { @class = "form-control" })</dd>

            <dt>@Html.LabelFor(model => model.BookingDate.BookingDateTime, "Booking Date", htmlAttributes: new { @class = "control-label col-md-2" })</dt>
            <dd>@Html.TextBoxFor(model => model.BookingDate.BookingDateTime, new { @class = "form-control", id = "datepicker" })</dd>
            <dd>@Html.ValidationMessageFor(model => model.BookingDate.BookingDateTime, "", new { @class = "text-danger" })</dd>

            <dt>@Html.LabelFor(model => model.BookingDate.ReturnDateTime, "Return Date", htmlAttributes: new { @class = "control-label col-md-2" })</dt>
            <dd>@Html.TextBoxFor(model => model.BookingDate.ReturnDateTime, new { @class = "form-control", id = "datepicker2" })</dd>

            <dd>@Html.ValidationMessageFor(model => model.BookingDate.ReturnDateTime, "", new { @class = "text-danger" })</dd>
        </dl>

        <div id="bookings">
            @if (Model.Bookings != null)
        {
            foreach (var booking in Model.Bookings)
            {
                <!--Partial View here-->
                @Html.Partial("_BookingPartial", booking)

        }
    }
        </div>

        @Html.HiddenFor(model => model.ApplicationUser.Id)
        @Html.HiddenFor(model => model.ApplicationUser.Name)
        <br />
        <button type="button" id="add" class="btn btn-primary">Click to add booking item + </button>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Create New Booking" class="btn btn-success btn-lg" />
            </div>
        </div>
    </div>
}

    <div align="left">
        <ul class="pager" align="left">
            <li><a href="javascript:void(0);" id="backLink"> << Back</a></li>
        </ul>
    </div>

@section scripts
{
    <script type="text/javascript">
        $(document).ready(function() {

            $('#datepicker').datepicker({
                //dateFormat: 'dd-mm-yy',
                dateFormat: 'mm/dd/yy',
                minDate: new Date()
            });

            var bookdate = new Date();
            $('#datepicker').on("change paste keyup",
                function () {
                    bookdate = $('#datepicker').val();
                });

            $('#datepicker2').datepicker({
                //dateFormat: 'dd-mm-yy',
                dateFormat: 'mm/dd/yy',
                minDate: bookdate
            });

            $('#datepicker2').on("change paste keyup",
                function () {

                    var returndate = $('#datepicker2').val();
                    if (returndate < bookdate) {
                        bootbox.alert("The return date must be after the booking date.");
                        $('#datepicker2').val('');
                    }
                });

            $(document).on('click', '#backLink', function () {
                history.go(-1);
            });

            var url = '@Url.Action("BookingPartialResult")';
            var form = $('form');
            var recipients = $('#bookings');

            $('#add').click(function() {
                $.get(url,
                    function(response) {
                        recipients.append(response);
                        // Reparse the validator for client side validation
                        form.data('validator', null);
                        $.validator.unobtrusive.parse(form);
                    });
            });

            $('#bookings').on('click',
                '.deleteRow',
                function() {
                    $(this).closest('.bookings').remove();
                });
        });

    </script>

    @if (ViewBag.OverloadBooking != null)
    {
        <script type="text/javascript">
                $(function() {
                    bootbox.alert("@ViewBag.OverloadBooking");
                });

        </script>
    }

    @if (ViewBag.ZeroBooking != null)
    {
        <script type="text/javascript">
            $(function() {
                bootbox.alert("@ViewBag.ZeroBooking");
            });

        </script>
    }

    @if (ViewBag.Error != null)
    {
        <script type="text/javascript">
            $(function() {
                bootbox.alert("@ViewBag.Error");
            });

        </script>
    }
}